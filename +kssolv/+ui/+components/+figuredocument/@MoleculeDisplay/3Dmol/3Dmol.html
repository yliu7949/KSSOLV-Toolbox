<!DOCTYPE html>
<html>
    <head>
        <script src="./3Dmol-min.js"></script>
        <style>
            .mol-container {
                width: 100%;
                height: 100vh;
                position: relative;
            }
            .context-menu {
                position: absolute;
                background-color: #f9f9f9;
                border: 1px solid #ccc;
                border-radius: 4px;
                box-shadow: 0 2px 5px rgba(0,0,0,0.2);
                padding: 5px 0;
                min-width: 150px;
                z-index: 1000;
                display: none;
            }
            .context-menu-item {
                padding: 8px 15px;
                cursor: pointer;
                font-family: Arial, sans-serif;
                font-size: 14px;
            }
            .context-menu-item:hover {
                background-color: #e9e9e9;
            }
        </style>
    </head>
    <body>
        <div id="container-01" class="mol-container"></div>
        <div id="context-menu" class="context-menu">
            <div class="context-menu-item" id="rezoom-option">Rezoom</div>
        </div>
        <script type="text/javascript">
            let MATLAB;
            let viewer;

            function setup(htmlComponent) {
                MATLAB = htmlComponent;
                htmlComponent.addEventListener("DataChanged", dataFromMATLABToHTML);
                setupContextMenu();
            };

            function dataFromMATLABToHTML(event) {
                let eventData = JSON.parse(event.Data);
                let type = eventData.type;
                let data = eventData.data;
                console.log("New data from MATLAB:\n", data);

                let element = document.querySelector('#container-01');
                let config = { backgroundColor: 'white' };
                viewer = $3Dmol.createViewer(element, config);
                let m = viewer.addModel(data, type);
                viewer.addUnitCell(m);
                viewer.setStyle({
                    'sphere': {
                        'colorscheme': 'Jmol',
                        'scale': .2
                    },
                    'stick': {
                        'colorscheme': 'Jmol',
                        'radius': 0.2
                    }
                });
                viewer.replicateUnitCell(1);
                viewer.zoomTo();
                viewer.render();
                viewer.zoom(1.5, 1500);
            }

            function setupContextMenu() {
                const container = document.getElementById('container-01');
                const contextMenu = document.getElementById('context-menu');
                const rezoomOption = document.getElementById('rezoom-option');

                // 防止默认的右键菜单
                container.addEventListener('contextmenu', function(e) {
                    e.preventDefault();
                    // 显示自定义右键菜单
                    contextMenu.style.display = 'block';
                    contextMenu.style.left = e.pageX + 'px';
                    contextMenu.style.top = e.pageY + 'px';
                    return false;
                });

                // 点击"Rezoom"选项时的操作
                rezoomOption.addEventListener('click', function() {
                    if (viewer) {
                        viewer.zoomTo();
                        viewer.render();
                    } else {
                        console.log("viewer 尚未初始化");
                    }
                    // 隐藏菜单
                    contextMenu.style.display = 'none';
                });

                // 点击页面其他地方时隐藏右键菜单
                document.addEventListener('click', function() {
                    contextMenu.style.display = 'none';
                });
            }
        </script>
    </body>
</html>